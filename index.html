<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi d'Entraînement</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        input[type="number"], input[type="checkbox"] {
            width: 50px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        input[type="checkbox"] {
            width: auto;
        }
        button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
            margin-bottom: 20px;
        }
        button:hover {
            background-color: #27ae60;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin-bottom: 30px;
        }
        @media (max-width: 600px) {
            table {
                font-size: 14px;
            }
            th, td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <h1>Suivi d'Entraînement</h1>
    
    <div id="workout-tables"></div>

    <button onclick="saveProgress()">Sauvegarder le progrès</button>

    <script>
        const workouts = [
            {
                name: "Séance 1 : Circuit Haut du Corps et Core",
                circuits: [
                    {
                        name: "Circuit A (3 tours, 40s travail, 20s repos)",
                        exercises: [
                            { name: "Pompes explosives", target: "15-20" },
                            { name: "Tractions", target: "8-12" },
                            { name: "Dips", target: "15-20" },
                            { name: "Mountain climbers", target: "30-40" },
                            { name: "Pompes diamant", target: "12-15" }
                        ]
                    },
                    {
                        name: "Circuit B (3 tours, 40s travail, 20s repos)",
                        exercises: [
                            { name: "Burpees sans saut", target: "12-15" },
                            { name: "Planche avec toucher d'épaule", target: "20-24" },
                            { name: "Pompes déclinées", target: "12-15" },
                            { name: "V-ups", target: "15-20" },
                            { name: "Pompes sur un bras", target: "6-8 (par bras)" }
                        ]
                    },
                    {
                        name: "Circuit C (2 tours, 30s travail, 15s repos)",
                        exercises: [
                            { name: "Tractions supination", target: "6-10" },
                            { name: "Pike push-ups", target: "10-12" },
                            { name: "Superman hold", target: "20-25s" },
                            { name: "Planche latérale avec rotation", target: "10-12 (par côté)" }
                        ]
                    }
                ]
            },
            // Ajoutez les autres séances ici de la même manière
        ];

        function createWorkoutTables() {
            const container = document.getElementById('workout-tables');
            workouts.forEach((workout, workoutIndex) => {
                const workoutDiv = document.createElement('div');
                workoutDiv.innerHTML = `<h2>${workout.name}</h2>`;
                
                workout.circuits.forEach((circuit, circuitIndex) => {
                    const table = document.createElement('table');
                    table.innerHTML = `
                        <tr>
                            <th>Exercice</th>
                            <th>Objectif</th>
                            <th>Réalisé</th>
                            <th>Objectif atteint</th>
                        </tr>
                    `;
                    
                    circuit.exercises.forEach((exercise, exerciseIndex) => {
                        const row = table.insertRow();
                        row.innerHTML = `
                            <td>${exercise.name}</td>
                            <td>${exercise.target}</td>
                            <td><input type="number" min="0" oninput="checkTarget(this); updateChart(${workoutIndex}, ${circuitIndex}, ${exerciseIndex}, this.value);"></td>
                            <td><input type="checkbox" disabled></td>
                        `;
                    });
                    
                    workoutDiv.appendChild(document.createElement('h3')).textContent = circuit.name;
                    workoutDiv.appendChild(table);

                    // Ajout du conteneur pour le graphique
                    const chartContainer = document.createElement('div');
                    chartContainer.className = 'chart-container';
                    chartContainer.innerHTML = `<canvas id="chart-${workoutIndex}-${circuitIndex}"></canvas>`;
                    workoutDiv.appendChild(chartContainer);

                    // Création du graphique
                    createChart(workoutIndex, circuitIndex, circuit.exercises);
                });
                
                container.appendChild(workoutDiv);
            });
        }

        function checkTarget(input) {
            const row = input.closest('tr');
            const targetCell = row.cells[1];
            const achievedValue = parseInt(input.value);
            const checkbox = row.cells[3].querySelector('input[type="checkbox"]');
            
            const targetRange = targetCell.textContent.split('-').map(Number);
            
            if (targetRange.length === 2) {
                checkbox.checked = achievedValue >= targetRange[0] && achievedValue <= targetRange[1];
            } else {
                const singleTarget = parseInt(targetCell.textContent);
                checkbox.checked = achievedValue >= singleTarget;
            }
        }

        function createChart(workoutIndex, circuitIndex, exercises) {
            const ctx = document.getElementById(`chart-${workoutIndex}-${circuitIndex}`).getContext('2d');
            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Séance 1', 'Séance 2', 'Séance 3', 'Séance 4', 'Séance 5'],
                    datasets: exercises.map((exercise, index) => ({
                        label: exercise.name,
                        data: [],
                        borderColor: getColor(index),
                        fill: false
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            chart.workoutIndex = workoutIndex;
            chart.circuitIndex = circuitIndex;
        }

        function getColor(index) {
            const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#d35400', '#34495e'];
            return colors[index % colors.length];
        }

        function updateChart(workoutIndex, circuitIndex, exerciseIndex, value) {
            const chart = Chart.getChart(`chart-${workoutIndex}-${circuitIndex}`);
            if (chart) {
                const dataset = chart.data.datasets[exerciseIndex];
                dataset.data.push(parseInt(value));
                if (dataset.data.length > 5) {
                    dataset.data.shift();
                }
                chart.update();
            }
        }

        function saveProgress() {
            const tables = document.querySelectorAll('table');
            const progress = [];
            
            tables.forEach(table => {
                const exercises = [];
                table.querySelectorAll('tr:not(:first-child)').forEach(row => {
                    exercises.push({
                        name: row.cells[0].textContent,
                        achieved: row.cells[2].querySelector('input').value,
                        targetMet: row.cells[3].querySelector('input').checked
                    });
                });
                progress.push(exercises);
            });
            
            localStorage.setItem('workoutProgress', JSON.stringify(progress));
            alert('Progrès sauvegardé !');
        }

        function loadProgress() {
            const savedProgress = JSON.parse(localStorage.getItem('workoutProgress'));
            if (savedProgress) {
                const tables = document.querySelectorAll('table');
                tables.forEach((table, tableIndex) => {
                    table.querySelectorAll('tr:not(:first-child)').forEach((row, rowIndex) => {
                        const achievedInput = row.cells[2].querySelector('input');
                        achievedInput.value = savedProgress[tableIndex][rowIndex].achieved;
                        checkTarget(achievedInput);
                        
                        // Mise à jour du graphique avec la valeur chargée
                        const workoutIndex = Math.floor(tableIndex / 3); // Supposant 3 circuits par séance
                        const circuitIndex = tableIndex % 3;
                        updateChart(workoutIndex, circuitIndex, rowIndex, achievedInput.value);
                    });
                });
            }
        }

        createWorkoutTables();
        window.onload = loadProgress;
    </script>
</body>
</html>
